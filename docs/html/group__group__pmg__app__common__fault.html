<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PmgAppCommon Middleware Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PmgAppCommon Middleware Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__pmg__app__common__fault.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">Fault protection</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>Fault handler provides API to monitor and handle the fault situations on the VBus or VConn voltage rails, and trip the supply to avoid damage to any of the system components. </p>
<p>Fault handler continuously monitors the voltages and compare with threshold values. Fault handler is built over the USB PD driver.</p>
<p><b>Features:</b></p><ul>
<li>VBus Reverse Current protection</li>
<li>VBus overvoltage protection</li>
<li>VBus undervoltage protection</li>
<li>VBus short-circuit protection</li>
<li>VBus overcurrent protection</li>
<li>VConn overcurrent protection</li>
</ul>
<h1><a class="anchor" id="section_pmg_app_common_fault_config"></a>
Configuration considerations</h1>
<p>The following steps describe the way to enable fault handler in an application.</p>
<ol type="1">
<li>Include fault_handlers.h and cy_pdl.h to get access to all functions and other declarations. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cy_pdl.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;cy_app_fault_handlers.h&quot;</span></div></div><!-- fragment --> <br />
</li>
<li>Defines the USB PD and PDStack data structures. <div class="fragment"><div class="line"><span class="keyword">static</span> cy_stc_usbpd_config_t    usbpdPort0Config;</div><div class="line"><span class="keyword">static</span> cy_stc_usbpd_context_t   usbPdPort0Ctx;</div><div class="line"><span class="keyword">static</span> cy_stc_pdstack_context_t pdStackPort0Context;</div></div><!-- fragment --> <br />
</li>
<li><p class="startli">Configure the fault parameters using the Device Configurator available in the ModusToolbox&trade; quick panel. </p><div class="image">
<img src="usbpd_fault_config.png" alt="usbpd_fault_config.png" width="90%"/>
</div>
<p class="startli"><br />
 Or, if the application uses a configuration table, configure the fault parameters using the Configuration Utility. Then initialize the fault configuration in the USB PD configuration structure. </p><div class="fragment"><div class="line">    usbpdPort0Config.vbusOvpConfig = (cy_stc_fault_vbus_ovp_cfg_t *)pd_get_ptr_ovp_tbl(&amp;usbPdPort0Ctx);</div><div class="line">    usbpdPort0Config.vbusUvpConfig = (cy_stc_fault_vbus_uvp_cfg_t *)pd_get_ptr_uvp_tbl(&amp;usbPdPort0Ctx);</div><div class="line">    usbpdPort0Config.vbusOcpConfig = (cy_stc_fault_vbus_ocp_cfg_t *)pd_get_ptr_ocp_tbl(&amp;usbPdPort0Ctx);</div><div class="line">    usbpdPort0Config.vbusScpConfig = (cy_stc_fault_vbus_scp_cfg_t *)pd_get_ptr_scp_tbl(&amp;usbPdPort0Ctx);</div><div class="line">    usbpdPort0Config.vbusRcpConfig = (cy_stc_fault_vbus_rcp_cfg_t *)pd_get_ptr_rcp_tbl(&amp;usbPdPort0Ctx);</div><div class="line">    usbpdPort0Config.vconnOcpConfig = (cy_stc_fault_vconn_ocp_cfg_t *)pd_get_ptr_vconn_ocp_tbl(&amp;usbPdPort0Ctx);</div></div><!-- fragment --><p> <br />
</p>
</li>
<li>Use the following make file defines to enable/disable faults<ul>
<li>VBUS_RCP_ENABLE</li>
<li>VBUS_SCP_ENABLE</li>
<li>VBUS_OCP_ENABLE</li>
<li>VBUS_OVP_ENABLE</li>
<li>VBUS_UVP_ENABLE</li>
<li>VCONN_OCP_ENABLE <br />
 <br />
</li>
</ul>
</li>
<li>Call the fault enable API to enable the desired fault detection <div class="fragment"><div class="line"><span class="preprocessor">    #if VBUS_UVP_ENABLE</span></div><div class="line">    <span class="comment">/* UVP callback. */</span> </div><div class="line">    <span class="keywordtype">bool</span> vbus_uvp_cbk(<span class="keywordtype">void</span> *context, <span class="keywordtype">bool</span> compOut)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Implement the application specific logic to handle the fault detection. */</span></div><div class="line">        </div><div class="line">        (void)context;</div><div class="line">        (void)compOut;</div><div class="line">        </div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="comment">/* Enable faults. */</span></div><div class="line">    <a class="code" href="group__group__pmg__app__common__fault__functions.html#ga79ccac53f88a2dbd95d4b6b67d5e5a27">Cy_App_Fault_UvpEnable</a>(&amp;pdStackPort0Context, 5000, <span class="keyword">false</span>, vbus_uvp_cbk);</div><div class="line"><span class="preprocessor">    #endif </span><span class="comment">/* VBUS_UVP_ENABLE */</span><span class="preprocessor"></span></div></div><!-- fragment --> <br />
</li>
<li>Invoke fault event handler from the application event handler to handle the events <div class="fragment"><div class="line">    <a class="code" href="group__group__pmg__app__common__fault__functions.html#ga3b47ce8b856a46f45c2e1b4f3430f4a6">Cy_App_Fault_EventHandler</a>(&amp;pdStackPort0Context, appEvent, NULL);</div></div><!-- fragment --> <br />
</li>
<li>Invoke the fault handler task form the main loop to handle the fault conditions <div class="fragment"><div class="line">    <a class="code" href="group__group__pmg__app__common__fault__functions.html#gafa5b9c0fff27a5bb85a3a0140dbf4ec0">Cy_App_Fault_Task</a>(&amp;pdStackPort0Context);</div></div><!-- fragment --> <br />
</li>
</ol>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__pmg__app__common__fault__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__pmg__app__common__fault__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>PmgAppCommon Middleware Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
