<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PmgAppCommon Middleware Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PmgAppCommon Middleware Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__pmg__app__common__usb.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">USB</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>Include cy_app_usb.h and cy_app_billboard.h to get access to all the functions and declarations used by the USB module. </p>
<p>See the configuration considerations section to start using the USB module.</p>
<p>The USB module operates on top of the USB device middleware library. It provides support for vendor, billboard and HID interfaces.</p>
<h1><a class="anchor" id="section_pmg_app_common_usb_config"></a>
Configuration considerations</h1>
<p>To enable USB module for the application, the steps are:</p>
<p>Step 1: Enable the USB device middleware. <br />
 Launch ModusToolbox(TM) library manager and enable the USB device middleware. This step is required if the ModusToolbox IDE is used. Otherwise, ensure the USB Device Middleware is included in your project.</p>
<p>Step 2: Write the USB descriptors.</p><ol type="1">
<li>Generate the USB descriptors and initialization arrays using the USB configurator.</li>
<li>If the descriptors are to be modified, then appropriate code should be added as per the application requirements.</li>
</ol>
<p>Step 3: Update main.c as follows:</p><ol type="1">
<li>Include headers to get access to the USB module. <div class="fragment"><div class="line"><span class="preprocessor">#if CY_APP_USB_ENABLE</span></div><div class="line"><span class="preprocessor">#if (CCG_BB_ENABLE != 0)</span></div><div class="line"><span class="preprocessor">#include &quot;cy_app_usb.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;cy_usb_dev.h&quot;</span></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CCG_BB_ENABLE != 0) */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CY_APP_USB_ENABLE */</span><span class="preprocessor"></span></div></div><!-- fragment --></li>
<li>Declare the USB context global variables. <div class="fragment"><div class="line"><span class="preprocessor">#if CY_APP_USB_ENABLE</span></div><div class="line"><span class="comment">/* USBDEV context variables */</span></div><div class="line">cy_stc_usbfs_dev_drv_context_t  gl_usb_drvContext;</div><div class="line">cy_stc_usb_dev_context_t        gl_usb_devContext;</div><div class="line"><span class="preprocessor">#if CY_APP_USB_HID_INTF_ENABLE</span></div><div class="line">cy_stc_usb_dev_hid_context_t    gl_usb_hidContext;</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CY_APP_USB_HID_INTF_ENABLE */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CY_APP_USB_ENABLE */</span><span class="preprocessor"></span></div></div><!-- fragment --></li>
<li>Declare and initialize the USB driver initialization context. Initialize the USB interface using the USB driver initialization context. <div class="fragment"><div class="line"><span class="preprocessor">#if CY_APP_USB_ENABLE</span></div><div class="line">    <a class="code" href="group__group__pmg__app__common__usb__data__structures.html#structcy__stc__usb__init__ctxt__t">cy_stc_usb_init_ctxt_t</a> usbInitContext;     <span class="comment">/* USB driver initialization context. */</span></div><div class="line">    </div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#a3959ddf298406e908fdcf2c50f806a06">base</a> = CYBSP_USBDEV_HW;                   <span class="comment">/* Pointer to USBFS base generated by Device configurator. */</span>   </div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#a77e37344c97343a8d0a426752ed69229">drvConfig</a> = &amp;CYBSP_USBDEV_config;         <span class="comment">/* Pointer to usbfs device driver configuration structure generated by Device configurator. */</span></div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#a703e9bf98ec0f24f8a8c4840178f83fb">usbDevConfig</a> = &amp;gl_dmc_usb_devConfig;     <span class="comment">/* Pointer to usb device configuration structure generated by USB configurator */</span></div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#a1ef43d3579b16e1207fd19039f9d0308">usbDevice</a> = &amp;gl_dmc_usb_devices[0];      <span class="comment">/* Pointer to usb device structure generated by USB configurator. */</span></div><div class="line"><span class="preprocessor">#if CY_APP_USB_HID_INTF_ENABLE</span></div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#a4744d5f5b6ebbe6c2515db392147c437">hidConfig</a> = &amp;gl_dmc_usb_hidConfig;       <span class="comment">/* Pointer to HID configuration structure generated by USB configurator. */</span></div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#a0bcc91a57bf87d9749c6efc3d6a8c48e">getReportCallback</a> = dmc_usb_hid_get_report_callback;        <span class="comment">/* Callback function to handle get report request. */</span></div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#af08c9add109eda24d7ec9815ed5b7bec">setReportCallback</a> = dmc_usb_hid_set_report_callback;        <span class="comment">/* Callback function to handle set report request. */</span></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CY_APP_USB_HID_INTF_ENABLE */</span><span class="preprocessor"></span></div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#a19f762721c8ecb0713005e5a28f497c8">vendor_req_handler</a> = vendor_req_handler;           <span class="comment">/* Vendor request handler. */</span></div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#a620c8615094b99ad94caf3cd85c510eb">usb_drvContext</a> = &amp;gl_usb_drvContext;</div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#afead7219d7d311c756da5cb2314d7003">usb_devContext</a> = &amp;gl_usb_devContext;</div><div class="line"><span class="preprocessor">#if CY_APP_USB_HID_INTF_ENABLE</span></div><div class="line">    usbInitContext.<a class="code" href="group__group__pmg__app__common__usb__data__structures.html#aebfdec51bef813c52a8d0f696314eb7a">usb_hidContext</a> = &amp;gl_usb_hidContext;</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CY_APP_USB_HID_INTF_ENABLE */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line">    <span class="comment">/* Initialize USB interface */</span></div><div class="line">    <a class="code" href="group__group__pmg__app__common__usb__functions.html#ga01e1e47413a8fd4962916c833bf3c6db">Cy_App_Usb_Init</a> (&amp;usbInitContext);</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CY_APP_USB_ENABLE */</span><span class="preprocessor"></span></div></div><!-- fragment --></li>
<li>If the application makes use of alternate modes, then Billboard support must be enabled. In this case, the USB module is automatically enabled when an alternate mode is entered or when tAMETimeout is expired. If alternate modes are not used, then enable the USB interface by using the API <a class="el" href="group__group__pmg__app__common__usb__functions.html#ga35b789f439ea4b22b4acd1bfa052f6cb" title="Enables the USB device. ">Cy_App_Usb_Enable()</a>. <div class="fragment"><div class="line"><span class="preprocessor">#if CY_APP_USB_ENABLE</span></div><div class="line">    <span class="comment">/* Enable the USB interface. */</span></div><div class="line">    <a class="code" href="group__group__pmg__app__common__usb__functions.html#ga35b789f439ea4b22b4acd1bfa052f6cb">Cy_App_Usb_Enable</a> ();</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CY_APP_USB_ENABLE */</span><span class="preprocessor"></span></div></div><!-- fragment --></li>
<li>Call tasks related to the USB module in the main loop. The commonly used tasks are: <br />
 a. <a class="el" href="group__group__pmg__app__common__app__functions.html#ga69364116a8fd3200b5d2085b6e9be99b" title="Handler for application level asynchronous tasks. ">Cy_App_Task()</a> which internally calls <a class="el" href="group__group__pmg__app__common__usb__functions.html#gaba69fa4088b1e08898ccb977053f4522" title="Billboard module task function. ">Cy_App_Usb_BbTask()</a> to handle billboard events. This task should be called if alternate modes are supported by the application. <br />
 b. Any custom task to handle events related to a USB interface. For example, HID task to handle HID events. <div class="fragment"><div class="line">    <span class="keywordflow">for</span> (;;)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__group__pmg__app__common__app__functions.html#ga69364116a8fd3200b5d2085b6e9be99b">Cy_App_Task</a>(&amp;gl_PdStackPortCtx);</div><div class="line"></div><div class="line"><span class="preprocessor">#if (CY_APP_USB_HID_INTF_ENABLE &amp;&amp; CY_APP_USB_ENABLE)</span></div><div class="line">        <span class="comment">/* Make sure that the device is in configured state before using data EPs for communication */</span></div><div class="line">        <span class="keywordflow">if</span>(CY_USB_DEV_CONFIGURED == gl_usb_devContext.state)</div><div class="line">        {</div><div class="line">            hid_task();</div><div class="line">        }</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CY_APP_USB_HID_INTF_ENABLE &amp;&amp; CY_APP_USB_ENABLE) */</span><span class="preprocessor">        </span></div><div class="line">    }    </div></div><!-- fragment --></li>
</ol>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__pmg__app__common__usb__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__pmg__app__common__usb__enums.html">enumerated types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__pmg__app__common__usb__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__pmg__app__common__usb__data__structures.html">data structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__pmg__app__common__usb__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__pmg__app__common__usb__functions.html">functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>PmgAppCommon Middleware Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
